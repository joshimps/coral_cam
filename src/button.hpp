#include "rclcpp/rclcpp.hpp"
#include "std_msgs/msg/bool.hpp"
#include "std_msgs/msg/int64.hpp"
#include <lgpio.h>
#include <functional>
#include <memory>
#include <chrono> 
#include <thread>

using namespace std::chrono_literals;

#define LFLAGS 0

namespace coral_cam{
    class Button : public rclcpp::Node{
        public:
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // Constructors and Destructors                                                                          //
            //////////////////////////////////////////////////////////////////////////////////////////////////////////
            Button(const rclcpp::NodeOptions &options);

            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // Public Methods                                                                                        //
            //////////////////////////////////////////////////////////////////////////////////////////////////////////
            
        private:
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // Callbacks                                                                                             //
            //////////////////////////////////////////////////////////////////////////////////////////////////////////
            int setGpioHandle(std_msgs::msg::Int64 msg);
            int setButtonPin(std_msgs::msg::Int64 msg);
            void readPin();
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // Private Methods                                                                                       //
            //////////////////////////////////////////////////////////////////////////////////////////////////////////

            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // Node,Timers, Publishers and Subscribers                                                                      //
            //////////////////////////////////////////////////////////////////////////////////////////////////////////
            rclcpp::Publisher<std_msgs::msg::Bool>::SharedPtr buttonPressedPublisher_;
            rclcpp::Subscription<std_msgs::msg::Int64>::SharedPtr gpioHandleSubscriber_;
            rclcpp::Subscription<std_msgs::msg::Int64>::SharedPtr buttonPinSubscriber_;
            rclcpp::TimerBase::SharedPtr timer_;
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // Constants                                                                                             //
            //////////////////////////////////////////////////////////////////////////////////////////////////////////
            const int lflags_ = 0;
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // Variables                                                                                             //
            //////////////////////////////////////////////////////////////////////////////////////////////////////////
            int gpioHandle_;
            int buttonPinNumber_;
            bool pinConfigured_;
            std_msgs::msg::Bool buttonPressedMessage_;

    };  
}